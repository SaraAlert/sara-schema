{
  "$id": "https://raw.githubusercontent.com/SaraAlert/sara-schema/master/schemas/assessment.json",
  "title": "Assessment",
  "description": "A patient asssessment root schema",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "response_status",
    "error_code",
    "threshold_condition_hash",
    "reported_symptoms_array",
    "experiencing_symptoms",
    "patient_submission_token"
  ],
  "properties": {
    "response_status": {
      "description": "Twilio response status information and codes, if present",
      "enum": [ "opt_out", "opt_in", "no_answer_voice", "no_answer_sms", "error_voice", "error_sms", "max_retries_sms", "max_retries_voice", "success_sms", "success_voice", null]
    },
    "error_code": {
      "description": "A Twilio error code",
      "type": ["null", "string"]
    },
    "threshold_condition_hash": {
      "description": "A way for an assessment to reference the set of symptoms and expected values that are associated with the assessment",
      "type": ["string", "null"],
      "pattern": "[a-f0-9]{64}"
    },
    "patient_submission_token": {
      "description": "Unique token used to validate existence of a patient for this assessement's submission. Supports old 40 character token, new 10 character tokens, and 34 character execution flow IDs",
      "type": ["string", "null"],
      "anyOf": [
        { "pattern": "^[a-f0-9]{40}$" },
        { "pattern": "^[a-zA-Z0-9_-]{10}$" },
        { "pattern": "^FN[a-f0-9]{32}$" }
      ]
    },
    "experiencing_symptoms": {
      "description": "Represents an assessment response over voice or SMS.",
      "type": ["boolean", "null"]
    },
    "reported_symptoms_array": {
      "description": "An array of symptoms and their values and types.",
      "type": ["array", "null"],
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "name",
          "value",
          "type",
          "label",
          "notes",
          "required"
        ],
        "properties": {
          "name": {
            "description": "The name of the symptom",
            "type": "string"
          },
          "value": {
            "description": "The reported condition of the symptom from the patient",
            "type": ["boolean", "number", "null"]
          },
          "type": {
            "description": "The internal application symptom type",
            "type": "string",
            "enum": [
              "BoolSymptom",
              "IntegerSymptom",
              "FloatSymptom"
            ]
          },
          "label": {
            "description": "The formatted name for printing of the symptom",
            "type": "string"
          },
          "notes": {
            "description": "Extended description of the symptom",
            "type": ["string", "null"]
          },
          "required": {
            "description": "The symptom's importance when determining if an assessment is symptomatic",
            "type": "boolean"
          }
        }
      }
    }
  }
}
